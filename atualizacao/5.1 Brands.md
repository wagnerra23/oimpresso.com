Etapa 5: Atualizar um Model Completo (Brand)

### Passos

#### 5.1 Atualizar Controller (`BrandController.php`)

1. Atualize métodos CRUD:

   ```php
   namespace App\Http\Controllers;

   use App\Models\Brand;
   use Illuminate\Http\Request;

   class BrandController extends Controller
   {
       public function index()
       {
           return view('brand.index');
       }

       public function create()
       {
           return view('brand.create');
       }

       public function store(Request $request)
       {
           $request->validate([
               'name' => 'required|string|max:255',
               'description' => 'nullable|string',
               'category' => 'required|string'
           ]);

           Brand::create($request->all());
           return redirect()->route('brands.index')->with('success', 'Marca criada com sucesso.');
       }

       public function show(Brand $brand)
       {
           return view('brand.show', compact('brand'));
       }

       public function edit(Brand $brand)
       {
           return view('brand.edit', compact('brand'));
       }

       public function update(Request $request, Brand $brand)
       {
           $request->validate([
               'name' => 'required|string|max:255',
               'description' => 'nullable|string',
               'category' => 'required|string'
           ]);

           $brand->update($request->all());
           return redirect()->route('brands.index')->with('success', 'Marca atualizada com sucesso.');
       }

       public function destroy(Brand $brand)
       {
           $brand->delete();
           return redirect()->route('brands.index')->with('success', 'Marca excluída com sucesso.');
       }

       public function partial(Request $request)
       {
           $brands = Brand::query()
               ->when($request->search, fn($query) => $query->where('name', 'like', "%{$request->search}%"))
               ->paginate(10);
           return response()->json($brands);
       }
   }
   ```

   **Mudanças**:- Linha 15: Adicionado `index` para renderizar `brand.index`.

   - Linha 20: Adicionado `create` para renderizar formulário.
   - Linha 25-33: Adicionado `store` com validação.
   - Linha 35: Adicionado `show` para detalhes.
   - Linha 40: Adicionado `edit` para edição.
   - Linha 45-53: Adicionado `update` com validação.
   - Linha 55: Adicionado `destroy` para exclusão.
   - Linha 60-65: Adicionado `partial` para DataGrid AJAX.

#### 5.2 Atualizar Model (`Brand.php`)

1. Configure:

   ```php
   namespace App\Models;

   use Illuminate\Database\Eloquent\Model;

   class Brand extends Model
   {
       protected $fillable = ['name', 'description', 'category'];
   }
   ```

   **Mudanças**:- Linha 8: Adicionado `$fillable` para campos.

#### 5.3 Atualizar Views

1. Crie `resources/views/brand/index.blade.php`:

   ```blade
   @extends('layouts.app')
   @section('content')
   <div class="card bg-base-100 shadow-xl">
       <div class="card-body">
           <div class="flex flex-wrap items-center justify-between gap-4">
               <div class="flex items-center gap-2">
                   <i class="fas fa-list"></i>
                   <h2 class="card-title">Marcas</h2>
                   <button class="btn btn-ghost btn-sm" title="Ajuda">?</button>
               </div>
               <div class="flex gap-2">
                   <button class="btn btn-neutral btn-sm"><i class="fas fa-file-excel"></i> Download Excel</button>
                   <a href="{{ route('brands.create') }}" class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Adicionar</a>
                   <button id="filter-btn" class="btn btn-outline btn-sm"><i class="fas fa-filter"></i> Filtros</button>
                   <input type="text" placeholder="Pesquisar..." class="input input-bordered w-full max-w-xs">
               </div>
           </div>
           <hr class="divider">
           <div id="filter-section" class="hidden flex flex-wrap gap-4">
               <div class="form-control w-full md:w-1/4">
                   <label class="label"><span class="label-text">Categoria</span></label>
                   <select class="select select-bordered w-full" id="category">
                       <option value="1">Categoria 1</option>
                       <option value="2">Categoria 2</option>
                   </select>
               </div>
           </div>
           <div class="overflow-x-auto">
               <table id="brand-table" class="table w-full">
                   <thead>
                       <tr>
                           <th>Nome</th>
                           <th>Ações</th>
                       </tr>
                   </thead>
                   <tbody></tbody>
               </table>
           </div>
       </div>
   </div>
   @endsection
   @section('javascripts')
   <script>
   $(document).ready(function() {
       $('#filter-btn').on('click', function() {
           $('#filter-section').toggleClass('hidden');
       });

       $('#brand-table').dxDataGrid({
           dataSource: {
               load: function(loadOptions) {
                   return $.ajax({
                       url: '{{ route('brands.partial') }}',
                       data: {
                           skip: loadOptions.skip || 0,
                           take: loadOptions.take || 10,
                           search: $('input[type="text"]').val()
                       },
                       method: 'GET',
                       dataType: 'json'
                   }).then(result => ({
                       data: result.data,
                       totalCount: result.total
                   }));
               }
           },
           columns: [
               { dataField: 'name', caption: 'Nome' },
               {
                   dataField: 'actions',
                   caption: 'Ações',
                   allowSorting: false,
                   allowFiltering: false,
                   cellTemplate: function(container, options) {
                       $('<a>').addClass('btn btn-primary btn-sm btn-modal')
                           .attr('href', '#')
                           .attr('data-href', `/brands/${options.data.id}/edit`)
                           .text('Editar')
                           .appendTo(container);
                       $('<a>').addClass('btn btn-error btn-sm ml-2')
                           .attr('href', `/brands/${options.data.id}`)
                           .attr('data-method', 'delete')
                           .text('Excluir')
                           .appendTo(container);
                   }
               }
           ],
           paging: { pageSize: 10 },
           pager: { visible: true },
           filterRow: { visible: true },
           searchPanel: { visible: true }
       });
   });
   </script>
   @endsection
   ```

   **Mudanças**:

   - Linha 1: Estende `app.blade.php`.
   - Linha 5-35: Implementa layout com card, filtros, DataGrid.
   - Linha 40-78: Adiciona script para DataGrid e filtros.
2. Crie `resources/views/brand/create.blade.php`:

   ```blade
   @extends('layouts.app')
   @section('content')
   <div class="card bg-base-100 shadow-xl">
       <div class="card-body">
           <h2 class="card-title">Criar Marca</h2>
           {!! Form::open(['url' => route('brands.store'), 'method' => 'POST', 'id' => 'brand_create_form']) !!}
           <div class="form-control">
               {!! Form::label('name', 'Nome:') !!}
               {!! Form::text('name', null, ['class' => 'input input-bordered w-full', 'required']) !!}
           </div>
           <div class="form-control">
               {!! Form::label('description', 'Descrição:') !!}
               {!! Form::textarea('description', null, ['class' => 'textarea textarea-bordered w-full']) !!}
           </div>
           <div class="form-control">
               {!! Form::label('category', 'Categoria:') !!}
               <select name="category" class="select select-bordered w-full select2">
                   <option value="1">Categoria 1</option>
                   <option value="2">Categoria 2</option>
               </select>
           </div>
           <button type="submit" class="btn btn-primary">Salvar</button>
           <a href="{{ route('brands.index') }}" class="btn btn-ghost">Cancelar</a>
           {!! Form::close() !!}
       </div>
   </div>
   @endsection
   ```

   **Mudanças**:

   - Linha 6-22: Formulário com classes DaisyUI.
3. Crie `resources/views/brand/edit.blade.php`:

   ```blade
   @extends('layouts.app')
   @section('content')
   <div class="card bg-base-100 shadow-xl">
       <div class="card-body">
           <h2 class="card-title">Editar Marca</h2>
           {!! Form::model($brand, ['url' => route('brands.update', $brand->id), 'method' => 'PUT', 'id' => 'brand_edit_form']) !!}
           <div class="form-control">
               {!! Form::label('name', 'Nome:') !!}
               {!! Form::text('name', null, ['class' => 'input input-bordered w-full', 'required']) !!}
           </div>
           <div class="form-control">
               {!! Form::label('description', 'Descrição:') !!}
               {!! Form::textarea('description', null, ['class' => 'textarea textarea-bordered w-full']) !!}
           </div>
           <div class="form-control">
               {!! Form::label('category', 'Categoria:') !!}
               <select name="category" class="select select-bordered w-full select2">
                   <option value="1" {{ $brand->category == 1 ? 'selected' : '' }}>Categoria 1</option>
                   <option value="2" {{ $brand->category == 2 ? 'selected' : '' }}>Categoria 2</option>
               </select>
           </div>
           <button type="submit" class="btn btn-primary">Salvar</button>
           <a href="{{ route('brands.index') }}" class="btn btn-ghost">Cancelar</a>
           {!! Form::close() !!}
       </div>
   </div>
   @endsection
   ```

   **Mudanças**:

   - Linha 6-24: Formulário de edição com valores pré-preenchidos.
4. Crie `resources/views/brand/show.blade.php`:

   ```blade
   @extends('layouts.app')
   @section('content')
   <div class="card bg-base-100 shadow-xl">
       <div class="card-body">
           <h2 class="card-title">Detalhes da Marca</h2>
           <p><strong>Nome:</strong> {{ $brand->name }}</p>
           <p><strong>Descrição:</strong> {{ $brand->description ?? 'N/A' }}</p>
           <p><strong>Categoria:</strong> {{ $brand->category == 1 ? 'Categoria 1' : 'Categoria 2' }}</p>
           <a href="{{ route('brands.index') }}" class="btn btn-primary">Voltar</a>
       </div>
   </div>
   @endsection
   ```

   **Mudanças**:

   - Linha 5-10: Exibe detalhes da marca.

5.5 Testar Funcionalidades

1. Acesse `/brands`:
   - Verifique listagem com DataGrid.
   - Teste filtros e pesquisa.
2. Acesse `/brands/create`:
   - Teste criação de marca.
   - Valide formulário (nome obrigatório).
3. Acesse `/brands/{id}/edit`:
   - Teste edição.
   - Confirme valores pré-preenchidos.
4. Acesse `/brands/{id}`:
   - Verifique detalhes.
5. Teste exclusão:
   - Confirme redirecionamento e mensagem de sucesso.
6. Verifique logs em `storage/logs/laravel.log`.


### Solução de Problemas

- **DataGrid não carrega**: Confirme URL em `dataSource` e resposta JSON.
- **Formulário não envia**: Verifique validação e CSRF.
- **Estilos quebrados**: Confirme classes DaisyUI.
